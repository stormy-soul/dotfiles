#!/usr/bin/bash

WALL_DIR="$HOME/Pictures/wallpapers/"
CACHE="$HOME/.cache/rofi/"

list=""

for img in "$WALL_DIR"/*; do
  base=$(basename "$img")
  thumb="$CACHE/$base"
  if [ ! -f "$thumb" ]; then
    convert "$img" -resize 1000x1000 "$thumb"
  fi
  list="$list$base\0icon\x1f$thumb\n"
done

selection=$(echo -e "$list" | rofi show -dmenu -columns 4 -theme wallpapers)
[ -z "$selection" ] && exit

selected="$WALL_DIR/$selection"
awww img --transition-type any --transition-bezier 0.05,0.9,0.1,1.05 --filter Nearest --resize fit "$selected"
wal -i "$selected" --cols16 darken --contrast 3.0 --saturate 0.7
